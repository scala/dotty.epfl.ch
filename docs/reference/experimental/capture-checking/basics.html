<!DOCTYPE html><html data-githubContributorsUrl="https://api.github.com/repos/scala/scala3" data-githubContributorsFilename="/docs/_docs/reference/experimental/capture-checking/basics.md" data-pathToRoot="../../../../" data-rawLocation="docs/reference/experimental/capture-checking/basics" data-dynamicSideMenu="false"><head><meta charset="utf-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"></meta><title>Capture Checking Basics</title><link rel="shortcut icon" type="image/x-icon" href="../../../../favicon.ico"></link><script type="text/javascript" src="../../../../scripts/theme.js"></script><script type="text/javascript" src="../../../../scripts/searchData.js" defer="true"></script><script type="text/javascript" src="../../../../scripts/scastieConfiguration.js" defer="true"></script><link rel="stylesheet" href="../../../../styles/theme/bundle.css"></link><link rel="stylesheet" href="../../../../styles/theme/components/bundle.css"></link><link rel="stylesheet" href="../../../../styles/theme/components/button/bundle.css"></link><link rel="stylesheet" href="../../../../styles/theme/layout/bundle.css"></link><link rel="stylesheet" href="../../../../styles/nord-light.css"></link><link rel="stylesheet" href="../../../../styles/dotty-icons.css"></link><link rel="stylesheet" href="../../../../styles/filter-bar.css"></link><link rel="stylesheet" href="../../../../styles/code-snippets.css"></link><link rel="stylesheet" href="../../../../styles/searchbar.css"></link><link rel="stylesheet" href="../../../../styles/social-links.css"></link><link rel="stylesheet" href="../../../../styles/versions-dropdown.css"></link><link rel="stylesheet" href="../../../../styles/content-contributors.css"></link><link rel="stylesheet" href="../../../../styles/fontawesome.css"></link><script type="text/javascript" src="../../../../hljs/highlight.pack.js" defer="true"></script><script type="text/javascript" src="../../../../scripts/hljs-scala3.js" defer="true"></script><script type="text/javascript" src="../../../../scripts/ux.js" defer="true"></script><script type="text/javascript" src="../../../../scripts/common/component.js" defer="true"></script><script type="text/javascript" src="../../../../scripts/common/utils.js" defer="true"></script><script type="text/javascript" src="../../../../scripts/components/FilterBar.js" defer="true"></script><script type="text/javascript" src="../../../../scripts/components/DocumentableList.js" defer="true"></script><script type="text/javascript" src="../../../../scripts/components/Input.js" defer="true"></script><script type="text/javascript" src="../../../../scripts/components/FilterGroup.js" defer="true"></script><script type="text/javascript" src="../../../../scripts/components/Filter.js" defer="true"></script><script type="text/javascript" src="../../../../scripts/scaladoc-scalajs.js" defer="true"></script><script type="text/javascript" src="../../../../scripts/contributors.js" defer="true"></script><script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js" defer="true"></script><script type="text/javascript" src="https://d3js.org/d3.v6.min.js" defer="true"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/graphlib-dot@0.6.2/dist/graphlib-dot.min.js" defer="true"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dagre-d3/0.6.1/dagre-d3.min.js" defer="true"></script><script type="text/javascript" src="https://scastie.scala-lang.org/embedded.js" defer="true"></script><script type="text/javascript" src="../../../../scripts/data.js" defer="true"></script><link rel="stylesheet" href="../../../../styles/staticsitestyles.css"></link><script>var pathToRoot = "../../../../";</script><script>var versionsDictionaryUrl = "https://scala-lang.org/api/versions.json";</script><link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="stylesheet" href="/css/dottydoc.css"></head><body><div id=""><div id="header" class="body-small"><div class="header-container-left"><a href="../../../../" class="logo-container"><span id="project-logo" class="project-logo"><img src="../../../../project-logo/logo.svg"></img></span><span id="dark-project-logo" class="project-logo"><img src="../../../../project-logo/logo_dark.svg"></img></span><span class="project-name h300">Scala 3</span></a><span onclick="dropdownHandler(event)" class="text-button with-arrow" id="dropdown-trigger"><a><div class="projectVersion">3.8.0-RC1-bin-20250821-0a7f843-NIGHTLY</div></a></span><div id="version-dropdown" class="dropdown-menu"></div></div><div class="header-container-right"><button id="search-toggle" class="icon-button"></button><a href="https://docs.scala-lang.org/" class="text-button">Learn</a><a href="https://www.scala-lang.org/download/" class="text-button">Install</a><a href="https://scastie.scala-lang.org" class="text-button">Playground</a><a href="https://index.scala-lang.org" class="text-button">Find A Library</a><a href="https://www.scala-lang.org/community/" class="text-button">Community</a><a href="https://www.scala-lang.org/blog/" class="text-button">Blog</a><span id="theme-toggle" class="icon-button"></span><span id="mobile-menu-toggle" class="icon-button hamburger"></span></div></div><div id="mobile-menu"><div class="mobile-menu-header body-small"><span class="mobile-menu-logo"><span id="project-logo" class="project-logo"><img src="../../../../project-logo/logo.svg"></img></span><span id="dark-project-logo" class="project-logo"><img src="../../../../project-logo/logo_dark.svg"></img></span><span class="project-name h300">Scala 3</span></span><button id="mobile-menu-close" class="icon-button close"></button></div><div class="mobile-menu-container body-medium"><input id="mobile-scaladoc-searchbar-input" class="scaladoc-searchbar-input" type="search" placeholder="Find anything"></input><a href="https://docs.scala-lang.org/" class="mobile-menu-item">Learn</a><a href="https://www.scala-lang.org/download/" class="mobile-menu-item">Install</a><a href="https://scastie.scala-lang.org" class="mobile-menu-item">Playground</a><a href="https://index.scala-lang.org" class="mobile-menu-item">Find A Library</a><a href="https://www.scala-lang.org/community/" class="mobile-menu-item">Community</a><a href="https://www.scala-lang.org/blog/" class="mobile-menu-item">Blog</a><span id="mobile-theme-toggle" class="mobile-menu-item mode"></span></div></div><span id="mobile-sidebar-toggle" class="floating-button"></span><div id="leftColumn" class="body-small"><div class="switcher-container"><a id="docs-nav-button" class="switcher h100 selected" href="../../../../index.html">Docs</a><a id="api-nav-button" class="switcher h100 " href="../../../../api/index.html">API</a></div><nav id="docs-nav" class="side-menu"><div class="ni n0 expanded"><span class="nh h100 expanded cs de"><button class="ar icon-button expanded"></button><a href="../../index.html"><span>Reference</span></a></span><div class="ni n1"><span class="nh de"><button class="ar icon-button "></button><a href="../../new-types/index.html"><span>New Types</span></a></span><div class="ni n2 "><span class="nh de"><a href="../../new-types/intersection-types.html"><span>Intersection Types</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../new-types/union-types.html"><span>Union Types</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../new-types/type-lambdas.html"><span>Type Lambdas</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../new-types/match-types.html"><span>Match Types</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../new-types/dependent-function-types.html"><span>Dependent Function Types</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../new-types/polymorphic-function-types.html"><span>Polymorphic Function Types</span></a></span></div></div><div class="ni n1"><span class="nh de"><button class="ar icon-button "></button><a href="../../enums/index.html"><span>Enums</span></a></span><div class="ni n2 "><span class="nh de"><a href="../../enums/enums.html"><span>Enumerations</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../enums/adts.html"><span>Algebraic Data Types</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../enums/desugarEnums.html"><span>Translation of Enums and ADTs</span></a></span></div></div><div class="ni n1"><span class="nh de"><button class="ar icon-button "></button><a href="../../contextual/index.html"><span>Contextual Abstractions</span></a></span><div class="ni n2 "><span class="nh de"><a href="../../contextual/givens.html"><span>Given Instances</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../contextual/using-clauses.html"><span>Using Clauses</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../contextual/context-bounds.html"><span>Context Bounds</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../contextual/deferred-givens.html"><span>Deferred Givens</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../contextual/given-imports.html"><span>Importing Givens</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../contextual/more-givens.html"><span>Other Forms Of Givens</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../contextual/extension-methods.html"><span>Extension Methods</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../contextual/right-associative-extension-methods.html"><span>Right-Associative Extension Methods: Details</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../contextual/type-classes.html"><span>Implementing Type classes</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../contextual/derivation.html"><span>Type Class Derivation</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../contextual/derivation-macro.html"><span>How to write a type class `derived` method using macros</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../contextual/multiversal-equality.html"><span>Multiversal Equality</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../contextual/context-functions.html"><span>Context Functions</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../contextual/conversions.html"><span>Implicit Conversions</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../contextual/by-name-context-parameters.html"><span>By-Name Context Parameters</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../contextual/relationship-implicits.html"><span>Relationship with Scala 2 Implicits</span></a></span></div></div><div class="ni n1"><span class="nh de"><button class="ar icon-button "></button><a href="../../metaprogramming/index.html"><span>Metaprogramming</span></a></span><div class="ni n2 "><span class="nh de"><a href="../../metaprogramming/inline.html"><span>Inline</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../metaprogramming/compiletime-ops.html"><span>Compile-time operations</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../metaprogramming/macros.html"><span>Macros</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../metaprogramming/simple-smp.html"><span>The Meta-theory of Symmetric Metaprogramming</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../metaprogramming/staging.html"><span>Run-Time Multi-Stage Programming</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../metaprogramming/reflection.html"><span>Reflection</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../metaprogramming/tasty-inspect.html"><span>TASTy Inspection</span></a></span></div></div><div class="ni n1"><span class="nh de"><button class="ar icon-button "></button><a href="../../other-new-features/index.html"><span>Other New Features</span></a></span><div class="ni n2 "><span class="nh de"><a href="../../other-new-features/trait-parameters.html"><span>Trait Parameters</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../other-new-features/transparent-traits.html"><span>Transparent Traits and Classes</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../other-new-features/creator-applications.html"><span>Universal Apply Methods</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../other-new-features/export.html"><span>Export Clauses</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../other-new-features/opaques.html"><span>Opaque Type Aliases</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../other-new-features/opaques-details.html"><span>Opaque Type Aliases: More Details</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../other-new-features/named-tuples.html"><span>Named Tuples</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../other-new-features/open-classes.html"><span>Open Classes</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../other-new-features/parameter-untupling.html"><span>Parameter Untupling</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../other-new-features/kind-polymorphism.html"><span>Kind Polymorphism</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../other-new-features/matchable.html"><span>The Matchable Trait</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../other-new-features/threadUnsafe-annotation.html"><span>The @threadUnsafe annotation</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../other-new-features/targetName.html"><span>The @targetName annotation</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../other-new-features/control-syntax.html"><span>New Control Syntax</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../other-new-features/indentation.html"><span>Optional Braces</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../other-new-features/safe-initialization.html"><span>Safe Initialization</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../other-new-features/type-test.html"><span>TypeTest</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../other-new-features/experimental-defs.html"><span>Experimental Definitions</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../other-new-features/preview-defs.html"><span>Preview Definitions</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../other-new-features/binary-literals.html"><span>Binary Integer Literals</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../other-new-features/toplevel-definitions.html"><span>Toplevel Definitions</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../other-new-features/better-fors.html"><span>Better fors</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../other-new-features/runtimeChecked.html"><span>The runtimeChecked method</span></a></span></div></div><div class="ni n1"><span class="nh de"><button class="ar icon-button "></button><a href="../../changed-features/index.html"><span>Other Changed Features</span></a></span><div class="ni n2 "><span class="nh de"><a href="../../changed-features/numeric-literals.html"><span>Numeric Literals</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../changed-features/structural-types.html"><span>Programmatic Structural Types</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../changed-features/operators.html"><span>Rules for Operators</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../changed-features/wildcards.html"><span>Wildcard Arguments in Types</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../changed-features/imports.html"><span>Imports</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../changed-features/type-inference.html"><span>Changes in Type Inference</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../changed-features/implicit-resolution.html"><span>Changes in Implicit Resolution</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../changed-features/implicit-conversions.html"><span>Implicit Conversions</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../changed-features/overload-resolution.html"><span>Changes in Overload Resolution</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../changed-features/match-syntax.html"><span>Match Expressions</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../changed-features/vararg-splices.html"><span>Vararg Splices</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../changed-features/pattern-bindings.html"><span>Pattern Bindings</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../changed-features/pattern-matching.html"><span>Option-less pattern matching</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../changed-features/eta-expansion.html"><span>Automatic Eta Expansion</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../changed-features/compiler-plugins.html"><span>Changes in Compiler Plugins</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../changed-features/lazy-vals-init.html"><span>Lazy Vals Initialization</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../changed-features/main-functions.html"><span>Main Methods</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../changed-features/interpolation-escapes.html"><span>Escapes in interpolations</span></a></span></div></div><div class="ni n1"><span class="nh de"><button class="ar icon-button "></button><a href="../../dropped-features/index.html"><span>Dropped Features</span></a></span><div class="ni n2 "><span class="nh de"><a href="../../dropped-features/delayed-init.html"><span>Dropped: DelayedInit</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../dropped-features/macros.html"><span>Dropped: Scala 2 Macros</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../dropped-features/existential-types.html"><span>Dropped: Existential Types</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../dropped-features/type-projection.html"><span>Dropped: General Type Projection</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../dropped-features/do-while.html"><span>Dropped: Do-While</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../dropped-features/procedure-syntax.html"><span>Dropped: Procedure Syntax</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../dropped-features/early-initializers.html"><span>Dropped: Early Initializers</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../dropped-features/class-shadowing.html"><span>Dropped: Class Shadowing</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../dropped-features/limit22.html"><span>Dropped: Limit 22</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../dropped-features/xml.html"><span>Dropped: XML Literals</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../dropped-features/symlits.html"><span>Dropped: Symbol Literals</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../dropped-features/auto-apply.html"><span>Dropped: Auto-Application</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../dropped-features/weak-conformance.html"><span>Dropped: Weak Conformance</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../dropped-features/nonlocal-returns.html"><span>Deprecated: Nonlocal Returns</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../dropped-features/this-qualifier.html"><span>Dropped: private[this] and protected[this]</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../dropped-features/wildcard-init.html"><span>Dropped: Wildcard Initializer</span></a></span></div></div><div class="ni n1 "><span class="nh de"><a href="../../preview/index.html"><span>Preview</span></a></span></div><div class="ni n1 expanded"><span class="nh h100 expanded cs de"><button class="ar icon-button expanded"></button><a href="../index.html"><span>Experimental</span></a></span><div class="ni n2 "><span class="nh de"><a href="../canthrow.html"><span>CanThrow Capabilities</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../erased-defs.html"><span>Erased Definitions</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../named-typeargs.html"><span>Named Type Arguments</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../numeric-literals.html"><span>Numeric Literals</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../explicit-nulls.html"><span>Explicit Nulls</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../main-annotation.html"><span>MainAnnotation</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../into.html"><span>The `into` Type and Modifier</span></a></span></div><div class="ni n2 expanded"><span class="nh h100 expanded cs de"><button class="ar icon-button expanded"></button><a href="index.html"><span>Capture Checking</span></a></span><div class="ni n3 expanded"><span class="nh h100 selected de"><a href="#"><span>Capture Checking Basics</span></a></span></div><div class="ni n3 "><span class="nh de"><a href="classes.html"><span>Capture Checking of Classes</span></a></span></div><div class="ni n3 "><span class="nh de"><a href="polymorphism.html"><span>Capability Polymorphism</span></a></span></div><div class="ni n3 "><span class="nh de"><a href="scoped-caps.html"><span>Scoped Caps</span></a></span></div><div class="ni n3 "><span class="nh de"><a href="classifiers.html"><span>Capability Classifiers</span></a></span></div><div class="ni n3 "><span class="nh de"><a href="checked-exceptions.html"><span>Checked Exceptions</span></a></span></div><div class="ni n3 "><span class="nh de"><a href="separation-checking.html"><span>Separation Checking</span></a></span></div><div class="ni n3 "><span class="nh de"><a href="how-to-use.html"><span>How to Use the Capture Checker</span></a></span></div><div class="ni n3 "><span class="nh de"><a href="internals.html"><span>Capture Checking Internals</span></a></span></div></div><div class="ni n2 "><span class="nh de"><a href="../purefuns.html"><span>Pure Function Syntax</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../tupled-function.html"><span>Tupled Function</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../modularity.html"><span>Modularity Improvements</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../typeclasses.html"><span>Better Support for Type Classes</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../unrolled-defs.html"><span>Automatic Parameter Unrolling</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../package-object-values.html"><span>Reference-able Package Objects</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../quoted-patterns-with-polymorphic-functions.html"><span>Quoted Patterns with Polymorphic Functions</span></a></span></div></div><div class="ni n1 "><span class="nh de"><a href="../../syntax.html"><span>Scala 3 Syntax Summary</span></a></span></div><div class="ni n1"><span class="nh de"><button class="ar icon-button "></button><a href="../../language-versions/index.html"><span>Language Versions</span></a></span><div class="ni n2 "><span class="nh de"><a href="../../language-versions/source-compatibility.html"><span>Source Compatibility</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../language-versions/binary-compatibility.html"><span>Binary Compatibility</span></a></span></div></div><div class="ni n1 "><span class="nh de"><a href="../../soft-modifier.html"><span>Soft Keywords</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../features-classification.html"><span>A Classification of Proposed Language Features</span></a></span></div></div><div class="ni n0"><span class="nh de"><button class="ar icon-button "></button><a href="../../../contributing/index.html"><span>Contributing</span></a></span><div class="ni n1 "><span class="nh de"><a href="../../../contributing/getting-started.html"><span>Getting Started</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../contributing/setting-up-your-ide.html"><span>Setting up your IDE</span></a></span></div><div class="ni n1"><span class="nh de"><button class="ar icon-button "></button><a href="../../../contributing/diagnosing-your-issue/index.html"><span>Diagnosing your issue</span></a></span><div class="ni n2 "><span class="nh de"><a href="../../../contributing/diagnosing-your-issue/reproduce.html"><span>Reproducing an Issue</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../../contributing/diagnosing-your-issue/cause.html"><span>Finding the Cause of an Issue</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../../contributing/diagnosing-your-issue/areas.html"><span>Common Issue Locations</span></a></span></div></div><div class="ni n1"><span class="nh de"><button class="ar icon-button "></button><a href="../../../contributing/debugging-the-compiler/index.html"><span>Debugging the Compiler</span></a></span><div class="ni n2 "><span class="nh de"><a href="../../../contributing/debugging-the-compiler/ide-debugging.html"><span>Debugging with your IDE</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../../contributing/debugging-the-compiler/inspection.html"><span>How to Inspect Values</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../../contributing/debugging-the-compiler/other-debugging.html"><span>Other Debugging Techniques</span></a></span></div></div><div class="ni n1 "><span class="nh de"><a href="../../../contributing/testing.html"><span>Testing Your Changes</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../contributing/scaladoc.html"><span>Scaladoc</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../contributing/community-build.html"><span>Community Build</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../contributing/sending-in-a-pr.html"><span>Sending in a pull request</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../contributing/cheatsheet.html"><span>Command Cheatsheet</span></a></span></div><div class="ni n1"><span class="nh de"><button class="ar icon-button "></button><a href="../../../contributing/procedures/index.html"><span>Procedures</span></a></span><div class="ni n2 "><span class="nh de"><a href="../../../contributing/procedures/release.html"><span>Release Procedure</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../../contributing/procedures/vulpix.html"><span>Test Vulpix Framework</span></a></span></div></div><div class="ni n1"><span class="nh de"><button class="ar icon-button "></button><a href="../../../contributing/architecture/index.html"><span>High Level Architecture</span></a></span><div class="ni n2 "><span class="nh de"><a href="../../../contributing/architecture/lifecycle.html"><span>Compiler Overview</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../../contributing/architecture/context.html"><span>Contexts</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../../contributing/architecture/phases.html"><span>Compiler Phases</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../../contributing/architecture/types.html"><span>Compiler Types</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../../contributing/architecture/time.html"><span>Time in the Compiler</span></a></span></div><div class="ni n2 "><span class="nh de"><a href="../../../contributing/architecture/symbols.html"><span>Symbols</span></a></span></div></div></div><div class="ni n0"><span class="nh de"><button class="ar icon-button "></button><a href="../../../internals/index.html"><span>Internals</span></a></span><div class="ni n1 "><span class="nh de"><a href="../../../internals/backend.html"><span>Backend Internals</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../internals/classpaths.html"><span>Classpaths</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../internals/contexts.html"><span>Contexts</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../internals/dotc-scalac.html"><span>Differences between Scalac and Dotty</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../internals/higher-kinded-v2.html"><span>Higher-Kinded Types in Dotty</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../internals/overall-structure.html"><span>Dotty Overall Structure</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../internals/explicit-nulls.html"><span>Explicit Nulls</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../internals/periods.html"><span>Dotc&apos;s concept of time</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../internals/syntax.html"><span>Scala 3 Syntax Summary</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../internals/type-system.html"><span>Type System</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../internals/dotty-internals-1-notes.html"><span>Dotty Internals 1: Trees &amp; Symbols (Meeting Notes)</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../internals/debug-macros.html"><span>Debug Macros</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../internals/gadts.html"><span>GADTs - Broad overview</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../internals/coverage.html"><span>Code Coverage for Scala 3</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../internals/best-effort-compilation.html"><span>Best Effort Compilation</span></a></span></div></div><div class="ni n0"><span class="nh de"><button class="ar icon-button "></button><a href="../../../../blog/index.html"><span>Blog (archive)</span></a></span><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2021/06/25/scala301-rc2.html"><span>Scala 3.0.1-RC2 – backports of critical bugfixes</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2021/06/07/scala3.0.1-rc1-release.html"><span>Scala 3.0.1-RC1 – further stabilising the compiler</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2021/04/21/scala3-rc3.html"><span>Scala 3.0.0-RC3 – bug fixes for 3.0.0 stable</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2021/03/31/scala3-rc2.html"><span>Scala 3.0.0-RC2 – getting ready for 3.0.0</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2021/02/17/scala3-rc1.html"><span>Scala 3.0.0-RC1 – first release candidate is here</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2020/12/18/scala3-m3.html"><span>Scala 3.0.0-M3: developer&apos;s preview before RC1</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2020/11/09/scala3-m1.html"><span>Scala 3.0.0-M1 is here</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2020/09/21/naming-schema-change.html"><span>Dotty becomes Scala 3</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2020/08/31/27th-dotty-milestone-release.html"><span>Announcing Dotty 0.27.0-RC1 - ScalaJS, performance, stability</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2020/07/27/26th-dotty-milestone-release.html"><span>Announcing Dotty 0.26.0-RC1 - unified extension methods and more</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2020/06/22/25th-dotty-milestone-release.html"><span>Announcing Dotty 0.25.0-RC2 - speed-up of givens and change in the tuple API</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2020/04/29/24th-dotty-milestone-release.html"><span>Announcing Dotty 0.24.0-RC1 - 2.13.2 standard library, better error messages and more</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2020/03/18/23rd-dotty-milestone-release.html"><span>Announcing Dotty 0.23.0-RC1 - safe initialization checks, type-level bitwise operations and more</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2020/02/05/22nd-dotty-milestone-release.html"><span>Announcing Dotty 0.22.0-RC1 - syntactic enhancements, type-level arithmetic and more</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2019/12/20/21th-dotty-milestone-release.html"><span>Announcing Dotty 0.21.0-RC1 - explicit nulls, new syntax for `match` and conditional givens, and more</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2019/11/04/20th-dotty-milestone-release.html"><span>Announcing Dotty 0.20.0-RC1 – `with` starting indentation blocks, inline given specializations and more</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2019/09/23/19th-dotty-milestone-release.html"><span>Announcing Dotty 0.19.0-RC1 – further refinements of the syntax and the migration to 2.13.1 standard library</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2019/08/30/18th-dotty-milestone-release.html"><span>Announcing Dotty 0.18.1-RC1 – switch to the 2.13 standard library, indentation-based syntax and other experiments</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2019/07/25/17th-dotty-milestone-release.html"><span>Announcing Dotty 0.17.0-RC1 – new implicit scoping rules and more</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2019/06/11/16th-dotty-milestone-release.html"><span>Announcing Dotty 0.16.0-RC3 – the Scala Days 2019 Release</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2019/05/23/15th-dotty-milestone-release.html"><span>Announcing Dotty 0.15.0-RC1 – the fully bootstrapped compiler</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2019/04/15/14th-dotty-milestone-release.html"><span>Announcing Dotty 0.14.0-RC1 with export, immutable arrays, creator applications and more</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2019/03/05/13th-dotty-milestone-release.html"><span>Announcing Dotty 0.13.0-RC1 with Spark support, top level definitions and redesigned implicits</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2019/01/21/12th-dotty-milestone-release.html"><span>Announcing Dotty 0.12.0-RC1</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2018/11/30/11th-dotty-milestone-release.html"><span>Announcing Dotty 0.11.0-RC1</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2018/10/10/10th-dotty-milestone-release.html"><span>Announcing Dotty 0.10.0-RC1</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2018/07/06/ninth-dotty-milestone-release.html"><span>Announcing Dotty 0.9.0-RC1</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2018/04/27/eighth-dotty-milestone-release.html"><span>Announcing Dotty 0.7.0 and 0.8.0-RC1</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2018/03/05/seventh-dotty-milestone-release.html"><span>Announcing Dotty 0.6.0 and 0.7.0-RC1</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2017/12/01/fifth-dotty-milestone-release.html"><span>Announcing Dotty 0.5.0-RC1</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2017/10/16/fourth-dotty-milestone-release.html"><span>Announcing Dotty 0.4.0-RC1</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2017/09/07/third-dotty-milestone-release.html"><span>Announcing Dotty 0.3.0-RC2</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2017/07/12/second-dotty-milestone-release.html"><span>Announcing Dotty 0.2.0-RC1, with new optimizations, improved stability and IDE support</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2017/05/31/first-dotty-milestone-release.html"><span>Announcing Dotty 0.1.2-RC1, a major step towards Scala 3</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2016/12/05/implicit-function-types.html"><span>Implicit Function Types</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2016/05/05/multiversal-equality.html"><span>Multiversal Equality for Scala</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2016/02/17/scaling-dot-soundness.html"><span>Scaling DOT to Scala - Soundness</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2016/02/03/essence-of-scala.html"><span>The Essence of Scala</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2016/01/02/new-year-resolutions.html"><span>New Year Resolutions</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../../../../blog/2015/10/23/dotty-compiler-bootstraps.html"><span>We got liftoff!</span></a></span></div></div></nav></div><div id="footer" class="body-small"><div class="left-container">Generated with</div><div class="right-container"><a href="https://github.com/scala/scala3"><button class="icon-button gh"></button></a><a href="https://discord.com/invite/scala"><button class="icon-button discord"></button></a><a href="https://twitter.com/scala_lang"><button class="icon-button twitter"></button></a><div class="text">Copyright (c) 2002-2025, LAMP/EPFL</div></div><div class="text-mobile">Copyright (c) 2002-2025, LAMP/EPFL</div></div><div id="scaladoc-searchBar"></div><div id="main"><div class="breadcrumbs container"><a href="../../../../index.html">Scala 3</a>/<a href="../../index.html">Reference</a>/<a href="../index.html">Experimental</a>/<a href="index.html">Capture Checking</a>/<a href="basics.html">Capture Checking Basics</a></div><div id="content" class="body-medium"><div><div id="content-wrapper">
 <div class="site-container">
  <div id="site-header"></div>
  <aside class="warning">
   <div class="icon"></div>
   <div class="content">
    This is a nightly documentation. The content of this page may not be consistent with the current stable version of language. Click <a href="https://docs.scala-lang.org/scala3/reference/experimental/capture-checking/basics.html">here</a> to find the stable version of this page.
   </div>
  </aside>
  <main>
   <header>
    <a class="text-button with-link body-small" href="https://github.com/scala/scala3/edit/main/docs/_docs/reference/experimental/capture-checking/basics.md">Edit this page on GitHub</a>
    <h1 class="h600">Capture Checking Basics</h1>
   </header>
   <section id="introduction">
    <h2 class="h500"><a href="#introduction" class="anchor"></a>Introduction</h2>
    <p>Capture checking can be enabled by the language import</p>
    <div class="snippet mono-small-block" scala-snippet="">
     <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>import language.experimental.captureChecking
</span></code></pre>
     <div class="buttons"></div>
    </div>
    <p>At present, capture checking is still highly experimental and unstable, and it evolves quickly. Before trying it out, make sure you have the latest version of Scala.</p>
    <p>To get an idea what capture checking can do, let's start with a small example:</p>
    <div class="snippet mono-small-block" scala-snippet="">
     <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>def usingLogFile[T](op: FileOutputStream =&gt; T): T =
</span><span line-number="2" class=""><span class="tooltip-container"></span>  val logFile = FileOutputStream("log")
</span><span line-number="3" class=""><span class="tooltip-container"></span>  val result = op(logFile)
</span><span line-number="4" class=""><span class="tooltip-container"></span>  logFile.close()
</span><span line-number="5" class=""><span class="tooltip-container"></span>  result
</span></code></pre>
     <div class="buttons"></div>
    </div>
    <p>The <code>usingLogFile</code> method invokes a given operation with a fresh log file as parameter. Once the operation has ended, the log file is closed and the operation's result is returned. This is a typical <em>try-with-resources</em> pattern, similar to many other such patterns which are often supported by special language constructs in other languages.</p>
    <p>The problem is that <code>usingLogFile</code>'s implementation is not entirely safe. One can undermine it by passing an operation that performs the logging at some later point after it has terminated. For instance:</p>
    <div class="snippet mono-small-block" scala-snippet="">
     <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>val later = usingLogFile { file =&gt; () =&gt; file.write(0) }
</span><span line-number="2" class=""><span class="tooltip-container"></span>later() // crash
</span></code></pre>
     <div class="buttons"></div>
    </div>
    <p>When <code>later</code> is executed it tries to write to a file that is already closed, which results in an uncaught <code>IOException</code>.</p>
    <p>Capture checking gives us the mechanism to prevent such errors <em>statically</em>. To prevent unsafe usages of <code>usingLogFile</code>, we can declare it like this:</p>
    <div class="snippet mono-small-block" scala-snippet="">
     <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>def usingLogFile[T](op: FileOutputStream^ =&gt; T): T =
</span><span line-number="2" class=""><span class="tooltip-container"></span>  // same body as before
</span></code></pre>
     <div class="buttons"></div>
    </div>
    <p>The only thing that's changed is that the <code>FileOutputStream</code> parameter of <code>op</code> is now followed by <code>^</code>. We'll see that this turns the parameter into a <em>capability</em> whose lifetime is tracked.</p>
    <p>If we now try to define the problematic value <code>later</code>, we get a static error:</p>
    <div class="snippet mono-small-block">
     <pre><code class="language-"><span line-number="1" class=""><span class="tooltip-container"></span><span class="hideable">   </span>|  val later = usingLogFile { f =&gt; () =&gt; f.write(0) }
</span><span line-number="2" class=""><span class="tooltip-container"></span><span class="hideable">   </span>|                           ^^^^^^^^^^^^^^^^^^^^^^^^^
</span><span line-number="3" class=""><span class="tooltip-container"></span><span class="hideable">   </span>|  Found:    (f: java.io.FileOutputStream^'s1) -&gt;'s2 () -&gt;{f} Unit
</span><span line-number="4" class=""><span class="tooltip-container"></span><span class="hideable">   </span>|  Required: java.io.FileOutputStream^ =&gt; () -&gt;'s3 Unit
</span><span line-number="5" class=""><span class="tooltip-container"></span><span class="hideable">   </span>|
</span><span line-number="6" class=""><span class="tooltip-container"></span><span class="hideable">   </span>|  Note that capability f cannot be included in outer capture set 's3.
</span></code></pre>
     <div class="buttons"></div>
    </div>
    <p>In this case, it was easy to see that the <code>logFile</code> capability escapes in the closure passed to <code>usingLogFile</code>. But capture checking also works for more complex cases. For instance, capture checking is able to distinguish between the following safe code:</p>
    <div class="snippet mono-small-block" scala-snippet="">
     <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>val xs = usingLogFile { f =&gt;
</span><span line-number="2" class=""><span class="tooltip-container"></span>  List(1, 2, 3).map { x =&gt; f.write(x); x * x }
</span><span line-number="3" class=""><span class="tooltip-container"></span>}
</span></code></pre>
     <div class="buttons"></div>
    </div>
    <p>and the following unsafe one:</p>
    <div class="snippet mono-small-block" scala-snippet="">
     <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>val xs = usingLogFile { f =&gt;
</span><span line-number="2" class=""><span class="tooltip-container"></span>  LzyList(1, 2, 3).map { x =&gt; f.write(x); x * x }
</span><span line-number="3" class=""><span class="tooltip-container"></span>}
</span></code></pre>
     <div class="buttons"></div>
    </div>
    <p>An error would be issued in the second case, but not the first one (this assumes a capture-aware formulation <code>LzyList</code> of lazily evaluated lists, which we will present later in this page).</p>
    <p>It turns out that capture checking has very broad applications. Besides the various try-with-resources patterns, it can also be a key part to the solutions of many other long standing problems in programming languages. Among them:</p>
    <ul>
     <li>How to have a simple and flexible system for checked exceptions. We show later how capture checking enables a clean and fully safe system for checked exceptions in Scala.</li>
     <li>How to address the problem of effect polymorphism in general.</li>
     <li>How to solve the "what color is your function?" problem of mixing synchronous and asynchronous computations.</li>
     <li>How to do region-based allocation, safely.</li>
     <li>How to reason about capabilities associated with memory locations.</li>
    </ul>
    <p>The following sections explain in detail how capture checking works in Scala 3.</p>
   </section>
   <section id="capabilities-and-capturing-types">
    <h2 class="h500"><a href="#capabilities-and-capturing-types" class="anchor"></a>Capabilities and Capturing Types</h2>
    <p>The capture checker extension introduces a new kind of types and it enforces some rules for working with these types.</p>
    <p>Capture checking is done in terms of <em>capturing types</em> of the form <code>T^{c₁, ..., cᵢ}</code>. Here <code>T</code> is a type, and <code>{c₁, ..., cᵢ}</code> is a <em>capture set</em> consisting of references to capabilities <code>c₁, ..., cᵢ</code>.</p>
    <p>An <em>object capability</em> is syntactically a method- or class-parameter, a local variable, or the <code>this</code> of an enclosing class. The type of a capability must be a capturing type with a non-empty capture set. We also say that variables that are capabilities are <em>tracked</em>.</p>
    <p>In a sense, every capability gets its authority from some other, more sweeping capability which it captures. The recursion stops with a <em>universal capability</em>, written <code>cap</code>, from which all other capabilities are ultimately derived. If <code>T</code> is a type, then <code>T^</code> is a shorthand for <code>T^{cap}</code>, meaning <code>T</code> can capture arbitrary capabilities.</p>
    <p>Here is an example:</p>
    <div class="snippet mono-small-block" scala-snippet="">
     <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>class FileSystem
</span><span line-number="2" class=""><span class="tooltip-container"></span>
</span><span line-number="3" class=""><span class="tooltip-container"></span>class Logger(fs: FileSystem^):
</span><span line-number="4" class=""><span class="tooltip-container"></span>  def log(s: String): Unit = ... // Write to a log file, using `fs`
</span><span line-number="5" class=""><span class="tooltip-container"></span>
</span><span line-number="6" class=""><span class="tooltip-container"></span>def test(fs: FileSystem^) =
</span><span line-number="7" class=""><span class="tooltip-container"></span>  val l: Logger^{fs} = Logger(fs)
</span><span line-number="8" class=""><span class="tooltip-container"></span>  l.log("hello world!")
</span><span line-number="9" class=""><span class="tooltip-container"></span>  val xs: LzyList[Int]^{l} =
</span><span line-number="10" class=""><span class="tooltip-container"></span>    LzyList.from(1)
</span><span line-number="11" class=""><span class="tooltip-container"></span>      .map { i =&gt;
</span><span line-number="12" class=""><span class="tooltip-container"></span>        l.log(s"computing elem # $i")
</span><span line-number="13" class=""><span class="tooltip-container"></span>        i * i
</span><span line-number="14" class=""><span class="tooltip-container"></span>      }
</span><span line-number="15" class=""><span class="tooltip-container"></span>  xs
</span></code></pre>
     <div class="buttons"></div>
    </div>
    <p>Here, the <code>test</code> method takes a <code>FileSystem</code> as a parameter. <code>fs</code> is a capability since its type has a non-empty capture set. The capability is passed to the <code>Logger</code> constructor and retained as a field in class <code>Logger</code>. Hence, the local variable <code>l</code> has type <code>Logger^{fs}</code>: it is a <code>Logger</code> which retains the <code>fs</code> capability.</p>
    <p>The second variable defined in <code>test</code> is <code>xs</code>, a lazy list that is obtained from <code>LzyList.from(1)</code> by logging and mapping consecutive numbers. Since the list is lazy, it needs to retain the reference to the logger <code>l</code> for its computations. Hence, the type of the list is <code>LzyList[Int]^{l}</code>. On the other hand, since <code>xs</code> only logs but does not do other file operations, it retains the <code>fs</code> capability only indirectly. That's why <code>fs</code> does not show up in the capture set of <code>xs</code>.</p>
    <p>Capturing types come with a subtype relation where types with "smaller" capture sets are subtypes of types with larger sets (the <em>subcapturing</em> relation is defined in more detail below). If a type <code>T</code> does not have a capture set, it is called <em>pure</em>, and is a subtype of any capturing type that adds a capture set to <code>T</code>.</p>
   </section>
   <section id="function-types">
    <h2 class="h500"><a href="#function-types" class="anchor"></a>Function Types</h2>
    <p>The usual function type <code>A =&gt; B</code> now stands for a function that can capture arbitrary capabilities. We call such functions <em>impure</em>. By contrast, the new single arrow function type <code>A -&gt; B</code> stands for a function that cannot capture any capabilities, or otherwise said, is <em>pure</em>. One can add a capture set after the arrow of an otherwise pure function. For instance, <code>A -&gt;{c, d} B</code> would be a function that can capture capabilities <code>c</code> and <code>d</code>, but no others. This type is a shorthand for <code>(A -&gt; B)^{c, d}</code>, i.e. the function type <code>A -&gt; B</code> with possible captures <code>{c, d}</code>.</p>
    <p>The impure function type <code>A =&gt; B</code> is treated as an alias for <code>A -&gt;{cap} B</code>. That is, impure functions are functions that can capture anything.</p>
    <p>A capture annotation <code>^</code> binds more strongly than a function arrow. So <code>A -&gt; B^{c}</code> is read as <code>A -&gt; (B^{c})</code> and <code>A -&gt; B^</code> is read as <code>A -&gt; (B^)</code>.</p>
    <p>Analogous conventions apply to context function types. <code>A ?=&gt; B</code> is an impure context function, with <code>A ?-&gt; B</code> as its pure complement.</p>
    <p><strong>Note 1:</strong> The identifiers <code>-&gt;</code> and <code>?-&gt;</code> are now treated as soft keywords when used as infix type operators. They are still available as regular identifiers for terms. For instance, the mapping syntax <code>Map("x" -&gt; 1, "y" -&gt; 2)</code> is still supported since it only applies to terms.</p>
    <p><strong>Note 2:</strong> The distinctions between pure vs impure function types do not apply to methods. In fact, since methods are not values they never capture anything directly. References to capabilities in a method are instead counted in the capture set of the enclosing object.</p>
   </section>
   <section id="by-name-parameter-types">
    <h2 class="h500"><a href="#by-name-parameter-types" class="anchor"></a>By-Name Parameter Types</h2>
    <p>A convention analogous to function types also extends to by-name parameters. In</p>
    <div class="snippet mono-small-block" scala-snippet="">
     <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>def f(x: =&gt; Int): Int
</span></code></pre>
     <div class="buttons"></div>
    </div>
    <p>the actual argument can refer to arbitrary capabilities. So the following would be OK:</p>
    <div class="snippet mono-small-block" scala-snippet="">
     <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>f(if p(y) then throw Ex() else 1)
</span></code></pre>
     <div class="buttons"></div>
    </div>
    <p>On the other hand, if <code>f</code> was defined like this</p>
    <div class="snippet mono-small-block" scala-snippet="">
     <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>def f(x: -&gt; Int): Int
</span></code></pre>
     <div class="buttons"></div>
    </div>
    <p>the actual argument to <code>f</code> could not refer to any capabilities, so the call above would be rejected. One can also allow specific capabilities like this:</p>
    <div class="snippet mono-small-block" scala-snippet="">
     <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>def f(x: -&gt;{c} Int): Int
</span></code></pre>
     <div class="buttons"></div>
    </div>
    <p>Here, the actual argument to <code>f</code> is allowed to use the <code>c</code> capability but no others.</p>
   </section>
   <section id="subtyping-and-subcapturing">
    <h2 class="h500"><a href="#subtyping-and-subcapturing" class="anchor"></a>Subtyping and Subcapturing</h2>
    <p>Capturing influences subtyping. As usual we write <code>T₁ &lt;: T₂</code> to express that the type <code>T₁</code> is a subtype of the type <code>T₂</code>, or equivalently, that <code>T₁</code> conforms to <code>T₂</code>. An analogous <em>subcapturing</em> relation applies to capture sets. If <code>C₁</code> and <code>C₂</code> are capture sets, we write <code>C₁ &lt;: C₂</code> to express that <code>C₁</code> <em>is covered by</em> <code>C₂</code>, or, swapping the operands, that <code>C₂</code> <em>covers</em> <code>C₁</code>.</p>
    <p>Subtyping extends as follows to capturing types:</p>
    <ul>
     <li>Pure types are subtypes of capturing types. That is, <code>T &lt;: T ^ C</code>, for any type <code>T</code>, capturing set <code>C</code>.</li>
     <li>For capturing types, smaller capturing sets produce subtypes: <code>T₁ ^ C₁ &lt;: T₂ ^ C₂</code> if <code>C₁ &lt;: C₂</code> and <code>T₁ &lt;: T₂</code>.</li>
    </ul>
    <p>A subcapturing relation <code>C₁ &lt;: C₂</code> holds if <code>C₂</code> <em>accounts for</em> every element <code>c</code> in <code>C₁</code>. This means one of the following three conditions must be true:</p>
    <ul>
     <li><code>c ∈ C₂</code>,</li>
     <li><code>c</code> refers to a parameter of some class <code>Cls</code> and <code>C₂</code> contains <code>Cls.this</code>,</li>
     <li><code>c</code>'s type has capturing set <code>C</code> and <code>C₂</code> accounts for every element of <code>C</code> (that is, <code>C &lt;: C₂</code>).</li>
    </ul>
    <p><strong>Example 1.</strong> Given</p>
    <div class="snippet mono-small-block" scala-snippet="">
     <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>fs: FileSystem^
</span><span line-number="2" class=""><span class="tooltip-container"></span>ct: CanThrow[Exception]^
</span><span line-number="3" class=""><span class="tooltip-container"></span>l : Logger^{fs}
</span></code></pre>
     <div class="buttons"></div>
    </div>
    <p>we have</p>
    <div class="snippet mono-small-block">
     <pre><code class="language-"><span line-number="1" class=""><span class="tooltip-container"></span>{l}  &lt;: {fs}     &lt;: {cap}
</span><span line-number="2" class=""><span class="tooltip-container"></span>{fs} &lt;: {fs, ct} &lt;: {cap}
</span><span line-number="3" class=""><span class="tooltip-container"></span>{ct} &lt;: {fs, ct} &lt;: {cap}
</span></code></pre>
     <div class="buttons"></div>
    </div>
    <p>The set consisting of the root capability <code>{cap}</code> covers every other capture set. This is a consequence of the fact that, ultimately, every capability is created from <code>cap</code>.</p>
    <p><strong>Example 2.</strong> Consider again the FileSystem/Logger example from before. <code>LzyList[Int]</code> is a proper subtype of <code>LzyList[Int]^{l}</code>. So if the <code>test</code> method in that example was declared with a result type <code>LzyList[Int]</code>, we'd get a type error. Here is the error message:</p>
    <div class="snippet mono-small-block">
     <pre><code class="language-"><span line-number="1" class=""><span class="tooltip-container"></span>11 |def test(using fs: FileSystem^): LzyList[Int] = {
</span><span line-number="2" class=""><span class="tooltip-container"></span>   |                                                 ^
</span><span line-number="3" class=""><span class="tooltip-container"></span>   |                                        Found:    LzyList[Int]^{fs}
</span><span line-number="4" class=""><span class="tooltip-container"></span>   |                                        Required: LzyList[Int]
</span></code></pre>
     <div class="buttons"></div>
    </div>
    <p>Why does it say <code>LzyList[Int]^{fs}</code> and not <code>LzyList[Int]^{l}</code>, which is, after all, the type of the returned value <code>xs</code>? The reason is that <code>l</code> is a local variable in the body of <code>test</code>, so it cannot be referred to in a type outside that body. What happens instead is that the type is <em>widened</em> to the smallest supertype that does not mention <code>l</code>. Since <code>l</code> has capture set <code>fs</code>, we have that <code>{fs}</code> covers <code>{l}</code>, and <code>{fs}</code> is acceptable in a result type of <code>test</code>, so <code>{fs}</code> is the result of that widening. This widening is called <em>avoidance</em>; it is not specific to capture checking but applies to all variable references in Scala types.</p>
   </section>
   <section id="capability-classes">
    <h2 class="h500"><a href="#capability-classes" class="anchor"></a>Capability Classes</h2>
    <p>Classes like <code>CanThrow</code> or <code>FileSystem</code> have the property that their values are always intended to be capabilities. We can make this intention explicit and save boilerplate by letting these classes extend the <code>SharedCapability</code> class defined in object <code>cap</code>.</p>
    <p>The capture set of type extending <code>SharedCapability</code> is always <code>{cap}</code>. This means we could equivalently express the <code>FileSystem</code> and <code>Logger</code> classes as follows:</p>
    <div class="snippet mono-small-block" scala-snippet="">
     <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>import caps.SharedCapability
</span><span line-number="2" class=""><span class="tooltip-container"></span>
</span><span line-number="3" class=""><span class="tooltip-container"></span>class FileSystem extends SharedCapability
</span><span line-number="4" class=""><span class="tooltip-container"></span>
</span><span line-number="5" class=""><span class="tooltip-container"></span>class Logger(using FileSystem):
</span><span line-number="6" class=""><span class="tooltip-container"></span>  def log(s: String): Unit = ???
</span><span line-number="7" class=""><span class="tooltip-container"></span>
</span><span line-number="8" class=""><span class="tooltip-container"></span>def test(using fs: FileSystem) =
</span><span line-number="9" class=""><span class="tooltip-container"></span>  val l: Logger^{fs} = Logger()
</span><span line-number="10" class=""><span class="tooltip-container"></span>  ...
</span></code></pre>
     <div class="buttons"></div>
    </div>
    <p>In this version, <code>FileSystem</code> is a capability class, which means that the <code>{cap}</code> capture set is implied on the parameters of <code>Logger</code> and <code>test</code>.</p>
    <p>Another, unrelated change in the version of the last example here is that the <code>FileSystem</code> capability is now passed as an implicit parameter. It is quite natural to model capabilities with implicit parameters since it greatly reduces the wiring overhead once multiple capabilities are in play.</p>
   </section>
   <section id="escape-checking">
    <h2 class="h500"><a href="#escape-checking" class="anchor"></a>Escape Checking</h2>
    <p>Capabilities follow the usual scoping discipline, which means that capture sets can contain only capabilities that are visible at the point where the set is defined.</p>
    <p>We now reconstruct how this principle produced the error in the introductory example, where <code>usingLogFile</code> was declared like this:</p>
    <div class="snippet mono-small-block" scala-snippet="">
     <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>def usingLogFile[T](op: FileOutputStream^ =&gt; T): T = ...
</span></code></pre>
     <div class="buttons"></div>
    </div>
    <p>The error message was:</p>
    <div class="snippet mono-small-block">
     <pre><code class="language-"><span line-number="1" class=""><span class="tooltip-container"></span><span class="hideable">   </span>|  val later = usingLogFile { f =&gt; () =&gt; f.write(0) }
</span><span line-number="2" class=""><span class="tooltip-container"></span><span class="hideable">   </span>|                           ^^^^^^^^^^^^^^^^^^^^^^^^^
</span><span line-number="3" class=""><span class="tooltip-container"></span><span class="hideable">   </span>|  Found:    (f: java.io.FileOutputStream^'s1) -&gt;'s2 () -&gt;{f} Unit
</span><span line-number="4" class=""><span class="tooltip-container"></span><span class="hideable">   </span>|  Required: java.io.FileOutputStream^ =&gt; () -&gt;'s3 Unit
</span><span line-number="5" class=""><span class="tooltip-container"></span><span class="hideable">   </span>|
</span><span line-number="6" class=""><span class="tooltip-container"></span><span class="hideable">   </span>|  Note that capability f cannot be included in outer capture set 's3.
</span></code></pre>
     <div class="buttons"></div>
    </div>
    <p>This error message was produced by the following logic:</p>
    <ul>
     <li>The <code>f</code> parameter has type <code>FileOutputStream^</code>, which makes it a capability.</li>
     <li>Therefore, the type of the expression <code>() =&gt; f.write(0)</code> is <code>() -&gt;{f} Unit</code>.</li>
     <li>This makes the type of the whole closure passed to <code>usingLogFile</code> the dependent function type <code>(f: FileOutputStream^'s1) -&gt;'s2 () -&gt;{f} Unit</code>, for some as yet uncomputed capture sets <code>'s1</code> and <code>'s2</code>.</li>
     <li>The expected type of the closure is a simple, parametric, impure function type <code>FileOutputStream^ =&gt; T</code>, for some instantiation of the type variable <code>T</code>.</li>
     <li>Matching with the found type, <code>T</code> must have the shape <code>() -&gt;'s3 Unit</code>, for some capture set <code>'s3</code> defined at the level of value <code>later</code>.</li>
     <li>That capture set cannot include the capability <code>f</code> since <code>f</code> is locally bound. This causes the error.</li>
    </ul>
    <p>An analogous restriction applies to the type of a mutable variable. Another way one could try to undermine capture checking would be to assign a closure with a local capability to a global variable. Maybe like this:</p>
    <div class="snippet mono-small-block" scala-snippet="">
     <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>var loophole: () =&gt; Unit = () =&gt; ()
</span><span line-number="2" class=""><span class="tooltip-container"></span>usingLogFile { f =&gt;
</span><span line-number="3" class=""><span class="tooltip-container"></span>  loophole = () =&gt; f.write(0)
</span><span line-number="4" class=""><span class="tooltip-container"></span>}
</span><span line-number="5" class=""><span class="tooltip-container"></span>loophole()
</span></code></pre>
     <div class="buttons"></div>
    </div>
    <p>But this will not compile either, since the capture set of the mutable variable <code>loophole</code> cannot refer to variable <code>f</code>, which is not visible where <code>loophole</code> is defined.</p>
    <p>Looking at object graphs, we observe a monotonicity property: The capture set of an object <code>x</code> covers the capture sets of all objects reachable through <code>x</code>. This property is reflected in the type system by the following <em>monotonicity rule</em>:</p>
    <ul>
     <li>In a class <code>C</code> with a field <code>f</code>, the capture set <code>{this}</code> covers the capture set <code>{this.f}</code> as well as the capture set of any application of <code>this.f</code> to pure arguments.</li>
    </ul>
   </section>
  </main>
  <div class="divider"></div>
  <nav class="arrow-navigation" aria-label="Page navigation">
   <div>
    <span class="body-small">Previous</span> <a rel="prev" href="index.html" aria-keyshortcuts="Left" class="body-medium"> <span class="body-medium">Capture Checking</span> </a>
   </div>
   <div>
    <span class="body-small arrow-navigation--next">Next</span> <a rel="next" href="classes.html" aria-keyshortcuts="Right" class="body-medium"> <span class="body-medium">Capture Checking of Classes</span> </a>
   </div>
  </nav>
  <div class="content-contributors hidden">
   <h1 class="h200">Contributors to this page</h1>
   <div id="documentation-contributors" class="contributors-container"></div>
   <div class="github-edit-button">
    <a class="text-button with-link body-small" href="https://github.com/scala/scala3/edit/main/docs/_docs/reference/experimental/capture-checking/basics.md"> Edit this page on GitHub </a>
   </div>
  </div>
 </div>
</div></div><div id="toc" class="body-small"><div id="toc-container"><span class="toc-title h200">In this article</span><nav class="toc-nav"><ul class="toc-list"><li><a href="#introduction">Introduction</a></li><li><a href="#capabilities-and-capturing-types">Capabilities and Capturing Types</a></li><li><a href="#function-types">Function Types</a></li><li><a href="#by-name-parameter-types">By-Name Parameter Types</a></li><li><a href="#subtyping-and-subcapturing">Subtyping and Subcapturing</a></li><li><a href="#capability-classes">Capability Classes</a></li><li><a href="#escape-checking">Escape Checking</a></li></ul></nav></div></div></div><div id="footer" class="body-small mobile-footer"><div class="left-container">Generated with</div><div class="right-container"><a href="https://github.com/scala/scala3"><button class="icon-button gh"></button></a><a href="https://discord.com/invite/scala"><button class="icon-button discord"></button></a><a href="https://twitter.com/scala_lang"><button class="icon-button twitter"></button></a><div class="text">Copyright (c) 2002-2025, LAMP/EPFL</div></div><div class="text-mobile">Copyright (c) 2002-2025, LAMP/EPFL</div></div></div></div></body></html>