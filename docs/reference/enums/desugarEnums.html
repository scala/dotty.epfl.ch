<html><head><meta charset="utf-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><title>Translation of Enums and ADTs</title><link rel="shortcut icon" type="image/x-icon" href="../../../favicon.ico"></link><script type="text/javascript" src="../../../scripts/clipboard.js" defer="true"></script><script type="text/javascript" src="../../../scripts/platform-content-handler.js" defer="true"></script><script type="text/javascript" src="../../../scripts/main.js" defer="true"></script><link rel="stylesheet" href="../../../styles/nord-light.css"></link><link rel="stylesheet" href="../../../styles/scalastyle.css"></link><link rel="stylesheet" href="../../../styles/dotty-icons.css"></link><link rel="stylesheet" href="../../../styles/diagram.css"></link><link rel="stylesheet" href="../../../styles/filter-bar.css"></link><link rel="stylesheet" href="../../../styles/search-bar.css"></link><script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js" defer="true"></script><script type="text/javascript" src="https://d3js.org/d3.v6.min.js" defer="true"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/graphlib-dot@0.6.2/dist/graphlib-dot.min.js" defer="true"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dagre-d3/0.6.1/dagre-d3.min.js" defer="true"></script><script type="text/javascript" src="../../../scripts/diagram.js" defer="true"></script><link rel="stylesheet" href="../../../styles/filter-bar.css"></link><script type="text/javascript" src="../../../hljs/highlight.pack.js" defer="true"></script><script type="text/javascript" src="../../../scripts/hljs-scala3.js" defer="true"></script><script type="text/javascript" src="../../../scripts/ux.js" defer="true"></script><script type="text/javascript" src="../../../scripts/common/component.js" defer="true"></script><script type="text/javascript" src="../../../scripts/common/utils.js" defer="true"></script><script type="text/javascript" src="../../../scripts/components/FilterBar.js" defer="true"></script><script type="text/javascript" src="../../../scripts/components/DocumentableList.js" defer="true"></script><script type="text/javascript" src="../../../scripts/components/Input.js" defer="true"></script><script type="text/javascript" src="../../../scripts/components/FilterGroup.js" defer="true"></script><script type="text/javascript" src="../../../scripts/components/Filter.js" defer="true"></script><script type="text/javascript" src="../../../scripts/data.js" defer="true"></script><script type="text/javascript" src="../../../scripts/fast-navigation-loader.js" defer="true"></script><link rel="stylesheet" href="../../../css/bootstrap.min.css"></link><link rel="stylesheet" href="../../../css/dottydoc.css"></link><link rel="stylesheet" href="../../../css/color-brewer.css"></link><script type="text/javascript" src="../../../js/jquery.min.js" defer="true"></script><script type="text/javascript" src="../../../js/bootstrap.min.js" defer="true"></script><script>var pathToRoot = "../../../";</script></head><body><div id="container"><div id="leftColumn"><div id="logo"><span><img src="../../../project-logo/logo.svg"></img></span><span><div class="projectName">Scala 3</div></span><span><div class="projectVersion">3.0.0-M3-bin-20201206-3cc191b-NIGHTLY</div></span></div><div id="paneSearch"></div><nav id="sideMenu"></nav></div><div id="main"><div id="leftToggler"><span class="icon-toggler"></span></div><div id="searchBar"></div><main>
  <div id="content" pageIds="_.docs/reference/enums/desugarEnums.md////PointingToDeclaration//-620175901">
    <div class="breadcrumbs"><a href="../../index.html">Scala 3</a>/<a href="../../Reference/index.html">Reference</a>/<a href="../../Enums/index.html">Enums</a>/<a href="desugarEnums.html">Translation of Enums and ADTs</a></div>
<html>
 <head>
  <link rel="dns-prefetch" href="//fonts.googleapis.com"> 
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin> 
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css"> 
 </head>
 <body>
  <div id="content-wrapper"> 
   <main class="container"> 
    <header> 
     <h1>Translation of Enums and ADTs</h1> 
     <div class="byline"> <a href="https://github.com/lampepfl/dotty/edit/master/docs/docs/reference/enums/desugarEnums.md#L"> <i class="far fa-edit"></i> Edit this page on GitHub </a> 
     </div> 
    </header> 
    <p>The compiler expands enums and their cases to code that only uses Scala's other language features. As such, enums in Scala are convenient <em>syntactic sugar</em>, but they are not essential to understand Scala's core.</p> 
    <p>We now explain the expansion of enums in detail. First, some terminology and notational conventions:</p> 
    <ul> 
     <li>We use <code>E</code> as a name of an enum, and <code>C</code> as a name of a case that appears in <code>E</code>.</li> 
     <li> <p>We use <code>&lt;...&gt;</code> for syntactic constructs that in some circumstances might be empty. For instance, <code>&lt;value-params&gt;</code> represents one or more parameter lists <code>(...)</code> or nothing at all.</p> </li> 
     <li> <p>Enum cases fall into three categories:</p> 
      <ul> 
       <li><em>Class cases</em> are those cases that are parameterized, either with a type parameter section <code>[...]</code> or with one or more (possibly empty) parameter sections <code>(...)</code>.</li> 
       <li><em>Simple cases</em> are cases of a non-generic enum that have neither parameters nor an extends clause or body. That is, they consist of a name only.</li> 
       <li><em>Value cases</em> are all cases that do not have a parameter section but that do have a (possibly generated) <code>extends</code> clause and/or a body.</li> 
      </ul> </li> 
    </ul> 
    <p>Simple cases and value cases are collectively called <em>singleton cases</em>.</p> 
    <p>The desugaring rules imply that class cases are mapped to case classes, and singleton cases are mapped to <code>val</code> definitions.</p> 
    <p>There are nine desugaring rules. Rule (1) desugar enum definitions. Rules (2) and (3) desugar simple cases. Rules (4) to (6) define <code>extends</code> clauses for cases that are missing them. Rules (7) to (9) define how such cases with <code>extends</code> clauses map into <code>case class</code>es or <code>val</code>s.</p> 
    <ol> 
     <li>An <code>enum</code> definition <pre><code class="language-scala">enum E ... { &lt;defs&gt; &lt;cases&gt; }
</code></pre> <p>expands to a <code>sealed abstract</code> class that extends the <code>scala.reflect.Enum</code> trait and an associated companion object that contains the defined cases, expanded according to rules (2 - 8). The enum class starts with a compiler-generated import that imports the names <code>&lt;caseIds&gt;</code> of all cases so that they can be used without prefix in the class.</p> <pre><code class="language-scala">sealed abstract class E ... extends &lt;parents&gt; with scala.reflect.Enum {
  import E.{ &lt;caseIds&gt; }
   &lt;defs&gt;
}
object E { &lt;cases&gt; }
</code></pre> </li> 
     <li>A simple case consisting of a comma-separated list of enum names <pre><code class="language-scala">case C_1, ..., C_n
</code></pre> <p>expands to</p> <pre><code class="language-scala">case C_1; ...; case C_n
</code></pre> <p>Any modifiers or annotations on the original case extend to all expanded cases.</p> </li> 
     <li>A simple case <pre><code class="language-scala">case C
</code></pre> <p>of an enum <code>E</code> that does not take type parameters expands to</p> <pre><code class="language-scala">val C = $new(n, "C")
</code></pre> <p>Here, <code>$new</code> is a private method that creates an instance of <code>E</code> (see below).</p> </li> 
     <li>If <code>E</code> is an enum with type parameters <pre><code class="language-scala">V1 T1 &gt;: L1 &lt;: U1 ,   ... ,    Vn Tn &gt;: Ln &lt;: Un      (n &gt; 0)
</code></pre> <p>where each of the variances <code>Vi</code> is either <code>'+'</code> or <code>'-'</code>, then a simple case</p> <pre><code class="language-scala">case C
</code></pre> <p>expands to</p> <pre><code class="language-scala">case C extends E[B1, ..., Bn]
</code></pre> <p>where <code>Bi</code> is <code>Li</code> if <code>Vi = '+'</code> and <code>Ui</code> if <code>Vi = '-'</code>. This result is then further rewritten with rule (8). Simple cases of enums with non-variant type parameters are not permitted (however value cases with explicit <code>extends</code> clause are)</p> </li> 
     <li>A class case without an extends clause <pre><code class="language-scala">case C &lt;type-params&gt; &lt;value-params&gt;
</code></pre> <p>of an enum <code>E</code> that does not take type parameters expands to</p> <pre><code class="language-scala">case C &lt;type-params&gt; &lt;value-params&gt; extends E
</code></pre> <p>This result is then further rewritten with rule (9).</p> </li> 
     <li>If <code>E</code> is an enum with type parameters <code>Ts</code>, a class case with neither type parameters nor an extends clause <pre><code class="language-scala">case C &lt;value-params&gt;
</code></pre> <p>expands to</p> <pre><code class="language-scala">case C[Ts] &lt;value-params&gt; extends E[Ts]
</code></pre> <p>This result is then further rewritten with rule (9). For class cases that have type parameters themselves, an extends clause needs to be given explicitly.</p> </li> 
     <li>If <code>E</code> is an enum with type parameters <code>Ts</code>, a class case without type parameters but with an extends clause <pre><code class="language-scala">case C &lt;value-params&gt; extends &lt;parents&gt;
</code></pre> <p>expands to</p> <pre><code class="language-scala">case C[Ts] &lt;value-params&gt; extends &lt;parents&gt;
</code></pre> <p>provided at least one of the parameters <code>Ts</code> is mentioned in a parameter type in <code>&lt;value-params&gt;</code> or in a type argument in <code>&lt;parents&gt;</code>.</p> </li> 
     <li>A value case <pre><code class="language-scala">case C extends &lt;parents&gt;
</code></pre> <p>expands to a value definition in <code>E</code>'s companion object:</p> <pre><code class="language-scala">val C = new &lt;parents&gt; { &lt;body&gt;; def ordinal = n }
</code></pre> <p>where <code>n</code> is the ordinal number of the case in the companion object, starting from 0. The anonymous class also implements the abstract <code>Product</code> methods that it inherits from <code>Enum</code>.</p> <p>It is an error if a value case refers to a type parameter of the enclosing <code>enum</code> in a type argument of <code>&lt;parents&gt;</code>.</p> </li> 
     <li>A class case <pre><code class="language-scala">case C &lt;params&gt; extends &lt;parents&gt;
</code></pre> <p>expands analogous to a final case class in <code>E</code>'s companion object:</p> <pre><code class="language-scala">final case class C &lt;params&gt; extends &lt;parents&gt;
</code></pre> <p>The enum case defines an <code>ordinal</code> method of the form</p> <pre><code class="language-scala">def ordinal = n
</code></pre> <p>where <code>n</code> is the ordinal number of the case in the companion object, starting from 0.</p> <p>It is an error if a value case refers to a type parameter of the enclosing <code>enum</code> in a parameter type in <code>&lt;params&gt;</code> or in a type argument of <code>&lt;parents&gt;</code>, unless that parameter is already a type parameter of the case, i.e. the parameter name is defined in <code>&lt;params&gt;</code>.</p> <p>The compiler-generated <code>apply</code> and <code>copy</code> methods of an enum case</p> <pre><code class="language-scala">case C(ps) extends P1, ..., Pn
</code></pre> <p>are treated specially. A call <code>C(ts)</code> of the apply method is ascribed the underlying type <code>P1 &amp; ... &amp; Pn</code> (dropping any <a href="../other-new-features/transparent-traits.html">transparent traits</a>) as long as that type is still compatible with the expected type at the point of application. A call <code>t.copy(ts)</code> of <code>C</code>'s <code>copy</code> method is treated in the same way.</p> </li> 
    </ol> 
    <h3><a href="#translation-of-enums-with-singleton-cases" id="translation-of-enums-with-singleton-cases" class="anchor"></a>Translation of Enums with Singleton Cases</h3> 
    <p>An enum <code>E</code> (possibly generic) that defines one or more singleton cases will define the following additional synthetic members in its companion object (where <code>E'</code> denotes <code>E</code> with any type parameters replaced by wildcards):</p> 
    <ul> 
     <li>A method <code>valueOf(name: String): E'</code>. It returns the singleton case value whose identifier is <code>name</code>.</li> 
     <li>A method <code>values</code> which returns an <code>Array[E']</code> of all singleton case values defined by <code>E</code>, in the order of their definitions.</li> 
    </ul> 
    <p>If <code>E</code> contains at least one simple case, its companion object will define in addition:</p> 
    <ul> 
     <li>A private method <code>$new</code> which defines a new simple case value with given ordinal number and name. This method can be thought as being defined as follows. <pre><code class="language-scala">private def $new(_$ordinal: Int, $name: String) = new E with runtime.EnumValue {
  def ordinal = _$ordinal
  override def productPrefix = $name // if not overridden in `E`
  override def toString = $name      // if not overridden in `E`
}
</code></pre> </li> 
    </ul> 
    <p>The anonymous class also implements the abstract <code>Product</code> methods that it inherits from <code>Enum</code>. The <code>ordinal</code> method is only generated if the enum does not extend from <code>java.lang.Enum</code> (as Scala enums do not extend <code>java.lang.Enum</code>s unless explicitly specified). In case it does, there is no need to generate <code>ordinal</code> as <code>java.lang.Enum</code> defines it. Similarly there is no need to override <code>toString</code> as that is defined in terms of <code>name</code> in <code>java.lang.Enum</code>. Finally, <code>productPrefix</code> will call <code>this.name</code> when <code>E</code> extends <code>java.lang.Enum</code>.</p> 
    <h3><a href="#scopes-for-enum-cases" id="scopes-for-enum-cases" class="anchor"></a>Scopes for Enum Cases</h3> 
    <p>A case in an <code>enum</code> is treated similarly to a secondary constructor. It can access neither the enclosing <code>enum</code> using <code>this</code>, nor its value parameters or instance members using simple identifiers.</p> 
    <p>Even though translated enum cases are located in the enum's companion object, referencing this object or its members via <code>this</code> or a simple identifier is also illegal. The compiler typechecks enum cases in the scope of the enclosing companion object but flags any such illegal accesses as errors.</p> 
    <h3><a href="#translation-of-java-compatible-enums" id="translation-of-java-compatible-enums" class="anchor"></a>Translation of Java-compatible enums</h3> 
    <p>A Java-compatible enum is an enum that extends <code>java.lang.Enum</code>. The translation rules are the same as above, with the reservations defined in this section.</p> 
    <p>It is a compile-time error for a Java-compatible enum to have class cases.</p> 
    <p>Cases such as <code>case C</code> expand to a <code>@static val</code> as opposed to a <code>val</code>. This allows them to be generated as static fields of the enum type, thus ensuring they are represented the same way as Java enums.</p> 
    <h3><a href="#other-rules" id="other-rules" class="anchor"></a>Other Rules</h3> 
    <ul> 
     <li> <p>A normal case class which is not produced from an enum case is not allowed to extend <code>scala.reflect.Enum</code>. This ensures that the only cases of an enum are the ones that are explicitly declared in it.</p> </li> 
     <li>If an enum case has an extends clause, the enum class must be one of the classes that's extended.</li> 
    </ul> 
   </main> 
  </div> 
  <script>
  ((window.gitter = {}).chat = {}).options = {
    room: 'lampepfl/dotty'
  };
</script> 
  <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>
 </body>
</html>  </div>
</main><footer><span class="go-to-top-icon"><a href="#container"><span class="icon-vertical_align_top"></span>&nbsp;Back to top</a></span>Generated by&nbsp;<a href="https://github.com/lampepfl/dotty/tree/master/scala3doc"><img src="../../../images/scala3doc_logo.svg" alt="Scala3doc" class="scala3doc_logo"></img></a></footer></div></div><script type="text/javascript" src="../../../scripts/pages.js"></script><script type="text/javascript" src="../../../scripts/main.js"></script></body></html>
